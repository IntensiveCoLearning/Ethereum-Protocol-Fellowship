---
timezone: Pacific/Auckland
---

# Bruce Xu

1. è‡ªæˆ‘ä»‹ç»ï¼šå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Bruce Xuï¼Œä»¥å¤ªåŠçˆ±å¥½è€…ï¼ŒLXDAO å’Œ ETHPanda è”åˆå‘èµ·äººï¼Œå¾ˆå¼€å¿ƒå‚åŠ ä»Šå¹´çš„ EPF æ®‹é…·å…±å­¦ã€‚
2. ä½ è®¤ä¸ºä½ ä¼šå®Œæˆæœ¬æ¬¡æ®‹é…·å­¦ä¹ å—ï¼Ÿä¼šçš„ï¼

## Notes

<!-- Content_START -->

# 2025.02.06

ä»Šå¤©å…ˆæŠŠ https://epf.wiki/#/ å¤§æ¦‚å¾—è¿‡ä¸€ä¸‹ï¼Œçœ‹çœ‹æ•´ä½“ç»“æ„å’Œä¸€äº›ç›¸å…³çš„ä¿¡æ¯ï¼Œåˆ—ä¸€äº› TODO è®°å½•è‡ªå·±æ„Ÿå…´è¶£çš„è¯é¢˜å’Œå†…å®¹ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„å­¦ä¹ ã€‚

å¡«å†™äº† surveyï¼š<https://forms.gle/G5V95qyGV8uMjKGcA>

ä»Šå¹´çš„ EPFsg æ˜¯ 2 å‘¨ intense çš„ä¹‹å‰è¯¾ç¨‹å›é¡¾ï¼Œç„¶å 6 å‘¨æ–°çš„åœ¨çº¿è¯¾ç¨‹ï¼Œè¦†ç›–å‡ ä¸ªéƒ¨åˆ†ã€‚

TODO è¿™ä¸¤å‘¨å¯ä»¥å¿«é€Ÿå¤ä¹  https://epf.wiki/#/eps/SG2024 24 å¹´çš„è¯¾ç¨‹å’Œç¬”è®°ã€‚


## [Prehistory of Ethereum](https://epf.wiki/#/wiki/protocol/prehistory)

ä»¥å¤ªåŠçš„æ„¿æ™¯æ¥è‡ªäºäº’è”ç½‘æ—©æœŸçš„å¼€æ”¾ç²¾ç¥ã€Unixã€GNU/Linuxã€Cypherpunksã€æ¯”ç‰¹å¸ç­‰ç­‰ï¼Œæ„å»ºä¸€ä¸ªæ— è¾¹ç•Œã€è‡ªæˆ‘ä¸»æƒçš„æ•°å­—ç»æµç”Ÿæ€ã€‚

"National borders are just speed bumps on the information superhighway."
â€” Timothy May, Cypherpunk.

äº’è”ç½‘çš„å…´èµ·ï¼Œæ‰“ç ´äº†å›½å®¶çš„ä¾¿æ·ï¼Œä¿ƒè¿›äº†ä¸å¯æƒ³è±¡çš„äººç±»äº’åŠ¨ã€‚

å¯†ç å­¦å’Œå¼€æºè½¯ä»¶ä½œä¸ºæ ¹åŸºï¼Œä¿ƒè¿›äº†äº’è”ç½‘æ–°äººï¼ŒåŠ©æ¨äº†ç”µå­å•†åŠ¡å’Œç½‘ä¸Šé“¶è¡Œä¸šåŠ¡çš„å¢é•¿ã€‚

Free software çš„ free æ˜¯ freedom è€Œä¸æ˜¯ priceã€‚ä½†æ˜¯ FOSS æ˜¯éå¸¸æœ‰ä»·å€¼å’Œè´¡çŒ®çš„ã€‚

90 å¹´ä»£å¼€å§‹ï¼Œå¯†ç æœ‹å…‹å°±æœ‰å¾ˆå¤šæ¬¡å¯¹äºå®ç° digital currency çš„å°è¯•ï¼Œä¾‹å¦‚ Digicashã€E-Goldã€B-Moneyã€Bitgoldã€Bitcoinã€‚è€Œ Bitcoin ä¸Šé¢å¼€å‘åº”ç”¨ç¨‹åºçš„å‡ æ¬¡å°è¯•éƒ½å¤±è´¥äº†ï¼Œæ‰€ä»¥æœ‰äº† Ethereum çš„è¯ç”Ÿã€‚

åˆ†äº«ï¼š<https://x.com/brucexu_eth/status/1887257222436298803>

## [Protocol Architecture Overview](https://epf.wiki/#/wiki/protocol/architecture)

æ‰§è¡Œå±‚å¤„ç†å®é™…äº¤æ˜“å’Œç”¨æˆ·äº¤äº’ï¼Œå…±è¯†å±‚æä¾›è¯æ˜çš„å…±è¯†æœºåˆ¶ã€‚

## [Protocol Design Philosophy](https://epf.wiki/#/wiki/protocol/design-rationale)

- ç®€å•
- æ™®éï¼šå›¾çµå®Œå¤‡çš„è™šæ‹Ÿæœº
- æ¨¡å—åŒ–
- ä¸­ç«‹ä¸æ­§è§†
- æ•æ·

åŸåˆ™ï¼š

- å°½é‡ç®€å•
- Freedomï¼šä½¿ç”¨æ—¶ï¼Œä¸ä¼šå—åˆ°é™åˆ¶æˆ–è€…æ­§è§†ã€‚
- Generalization
- æ²¡æœ‰ä»»ä½•ç‰¹æ€§ï¼šå¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦è‡ªå·±è®¾è®¡

å®é™…ä¸Šæˆ‘æ„Ÿè§‰ä»¥å¤ªåŠåè®®è¿˜æ˜¯å¤ªå¤æ‚äº†ï¼Œé¿å…ä¸äº†è½¯ä»¶å·¥ç¨‹çš„å±å±±çš„å½’é€”ã€‚æŒ‰ç…§æ¶æ„çš„æ¼”è¿›ï¼Œæ¨¡å—åŒ–è‚¯å®šæ˜¯å¿…ç„¶ï¼Œåˆ†å±‚çš„è®¾è®¡éœ€è¦éå¸¸æ¸…æ™°å’Œèƒ½çœ‹åˆ°å…¨å±€çš„èµ„æ·±ç ”ç©¶å‘˜ã€‚

TODO ç»˜åˆ¶ä»¥å¤ªåŠçš„åˆ†å±‚æ¶æ„å›¾ã€‚

UTXO vs Accountï¼šè¿™æ˜¯ä¸ªæ¯”è¾ƒå¤§çš„è¯é¢˜ï¼Œä¸è¿‡æ™ºèƒ½åˆçº¦çš„å®ç°ï¼Œè´¦å·ç¡®å®æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚

Merkle-Patricia Trie æ˜¯ä»¥å¤ªåŠçš„å­˜å‚¨æ•°æ®ç»“æ„ï¼Œé«˜æ•ˆæ£€ç´¢çš„èƒ½åŠ›æ„æˆäº†ä»¥å¤ªåŠçŠ¶æ€çš„å„é¡¹æ•°æ®ã€‚

TODO è·å–ä¸€ä¸‹ä»¥å¤ªåŠçš„ state tree çœŸå®æ•°æ®çœ‹çœ‹

MPT æ­£åœ¨è¢«è€ƒè™‘å¼ƒç”¨ï¼Œå‡†å¤‡ä½¿ç”¨ Verkle treeï¼Œå®ç°æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ã€‚

TODO ç®€å•äº†è§£ MPT ä¹‹åï¼Œé‡ç‚¹ç ”ç©¶ Verkle tree

ç›®å‰çš„èŠ‚ç‚¹çŠ¶æ€æ•°æ®åŒ…æ‹¬ 1-2TBï¼Œå…¶å®æŒºéº»çƒ¦çš„ï¼Œå¯åŠ¨èŠ‚ç‚¹ç­‰è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚

# 2025.02.07

## [Protocol Design Philosophy](https://epf.wiki/#/wiki/protocol/design-rationale)

Recursive Length Prefix (RLP) åˆ›å»ºæ–°åºåˆ—åŒ–æ–¹æ¡ˆçš„ç†ç”±åœ¨äºå…¶ä»–æ–¹æ¡ˆçš„æ¦‚ç‡æ€§è´¨ã€‚RLP é€šè¿‡ç®€å•è€Œç¡®å®šçš„åºåˆ—åŒ–è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œå¹¶ä¿è¯äº†ç»å¯¹çš„å­—èŠ‚çº§ä¸€è‡´æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªåºåˆ—åŒ–æ•°æ®çš„ç®—æ³•ï¼Ÿ

Simple serialize (SSZ) åºåˆ—åŒ–æ˜¯å°†æ•°æ®ç»“æ„è½¬æ¢ä¸ºå¯ä»¥ä¼ è¾“å¹¶åœ¨ä»¥åé‡å»ºçš„æ ¼å¼çš„è¿‡ç¨‹ã€‚SSZ æ˜¯ä»¥å¤ªåŠ 2.0 ä¿¡æ ‡é“¾ä¸­ä½¿ç”¨çš„ä¸€ç§åºåˆ—åŒ–æ ¼å¼ã€‚æ ¹æ® Vitalik çš„è¯„è®ºï¼ŒSSZ è¯•å›¾è§£å†³çš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯ RLP ä¸å…è®¸ Merkle åŒ–ï¼Œè¿™å°†æ„å‘³ç€æ’é™¤äº†ä»»ä½•ç®€æ´è½»å®¢æˆ·ç«¯è¯æ˜çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œæ— æ³•å®ç°æ— çŠ¶æ€æ€§â€”â€”è€Œæ— çŠ¶æ€æ€§ä»ç„¶æ˜¯å½“å‰ä»¥å¤ªåŠç ”å‘çš„å…³é”®ç›®æ ‡ã€‚

Casper Friendly Finality Gadget (FFG) ç”¨äºå®ç° finalityï¼Œfinality è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª block å’Œé‡Œé¢çš„æ•°æ®ï¼Œå†ä¹Ÿæ— æ³•è¢«ä¿®æ”¹æˆ–è€… removeã€‚é€šè¿‡åœ¨ proposal æœºåˆ¶ä¹‹ä¸Šï¼Œé€šè¿‡é€‰æ‹©ä»£è¡¨ canonical transaction ledger çš„å”¯ä¸€é“¾æ¥æœ€ç»ˆç¡®å®šåŒºå—ã€‚

Byzantine Fault Tolerance (BFT) æ‹œå åº­å°†å†›å®¹é”™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿçš„ç‰¹æ€§ã€‚åº”å¯¹çš„æŒ‘æˆ˜æ˜¯åœ¨ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ç¯å¢ƒï¼Œå¦‚ä½•åœ¨æŸäº›èŠ‚ç‚¹æ•…éšœæˆ–è€…å­˜åœ¨æ¶æ„è¡Œä¸ºä¸‹è¾¾æˆä¸€è‡´ã€‚æ¯”å¦‚ PoS å°±æ˜¯é’ˆå¯¹è¿™ä¸ªé—®é¢˜å®ç°çš„ç®—æ³•ï¼Œæ¥ç¡®ä¿åœ¨å»ä¸­å¿ƒåŒ–ç¯å¢ƒä¸‹å®ç°ä¸€è‡´ã€‚

Latest Message Driven Greediest Heaviest Observed Sub-Tree (LMD-GHOST) æ˜¯ä¸€ä¸ªåˆ†æ”¯é€‰æ‹©çš„è§„åˆ™ã€‚æœ‰ç‚¹ç±»ä¼¼ PoW ä½¿ç”¨çš„åˆ†å‰é€‰æ‹©ï¼Œå…¶ä¸­å®Œæˆæœ€å¤šå·¥ä½œçš„è¢«é€‰ä¸º canonical chainã€‚

Gasper æ˜¯ä¸€ä¸ªå®Œå…¨çš„ PoS protoclï¼Œç»“åˆäº† casper FFG å’Œ LMD-GHOST æ¥æ¨åŠ¨ Eth2 çš„å…±è¯†å±‚æœºåˆ¶ã€‚

Using a DHT DHTï¼ˆåˆ†å¸ƒå¼å“ˆå¸Œè¡¨ï¼‰çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå®ƒçš„æŸ¥æ‰¾æ“ä½œåœ¨ç½‘ç»œä¸­ä»…äº§ç”Ÿå¯¹æ•°çº§åˆ«çš„é€šä¿¡å¼€é”€ã€‚å› æ­¤ï¼Œå®ƒéå¸¸é€‚ç”¨äºåœ¨ P2P ç½‘ç»œä¸­æŸ¥æ‰¾ï¼ˆæŸ¥è¯¢ï¼‰å†…å®¹ã€‚ä½†ä¸€ä¸ªç›´æ¥çš„é—®é¢˜æ˜¯ï¼šåœ¨ä»¥å¤ªåŠä¸­ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦æŸ¥æ‰¾å†…å®¹ï¼Ÿæ¯•ç«Ÿï¼Œå¤§å¤šæ•°èŠ‚ç‚¹éƒ½å…³æ³¨ç›¸åŒçš„å†…å®¹â€”â€”å³æœ€æ–°çš„åŒºå—ã€‚ç”±äºå…±è¯†æ§½ï¼ˆconsensus slotï¼‰åœ¨æ¯ä¸ªæ—¶åˆ»åªä¼šäº§ç”Ÿä¸€ä¸ªåŒºå—ï¼Œå¹¶ä¸”è¯¥åŒºå—é€šè¿‡gossip åè®®è¿›è¡Œä¼ æ’­ï¼Œå› æ­¤é“¾çš„æœ€æ–°çŠ¶æ€ï¼ˆtip of the chainï¼‰å§‹ç»ˆæ˜¯ä¸€è‡´çš„ã€‚åœ¨ BitTorrent å’Œ IPFS è¿™æ ·çš„åè®®ä¸­ï¼ŒDHT ç”¨äºå­˜å‚¨å„ç§å†…å®¹ï¼Œå¹¶å¸®åŠ©ç”¨æˆ·æŸ¥æ‰¾ä»–ä»¬æ„Ÿå…´è¶£çš„å†…å®¹ã€‚è€Œåœ¨ä»¥å¤ªåŠçš„ç½‘ç»œå±‚ï¼ŒDHT å¹¶ä¸æ˜¯ç”¨äºæŸ¥æ‰¾åŒºå—ï¼Œè€Œæ˜¯ç”¨äºå‘ç°ä¸åŒçš„å¯¹ç­‰èŠ‚ç‚¹ï¼ˆpeersï¼‰ã€‚

discv5 æ˜¯ä¸€ä¸ª Ethereum ä½¿ç”¨çš„ discovery protocolï¼Œä½¿ç”¨ kademlia based DHT æ¥å­˜å‚¨ ENR records. ENR è®°å½•åŒ…æ‹¬è·¯ç”±ä¿¡æ¯æ¥å»ºç«‹ P2P é“¾æ¥ã€‚

# 2025.02.08

## [Protocol history and evolution](https://epf.wiki/#/wiki/protocol/history)

å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ä»¥å¤ªåŠå‡çº§ï¼š

- Frontier æ˜¯ Ethereum Protocol çš„å‘èµ·ï¼Œåœ¨ 2015 7 æœˆ 30 æ—¥ä¸Šçº¿ï¼Œåˆ›ä¸–åŒºå— <https://etherscan.io/block/0>
- Homestead åœ¨ 2016 å¹´ 3 æœˆ 14 æ—¥ä¸Šçº¿ã€‚æ˜¯ä¸€ä¸ªæ›´åŠ æˆç†Ÿç¨³å®šçš„å¹³å°ï¼ŒåŒ…æ‹¬ EIP-2ã€EIP-7ã€EIP-8 ç­‰å‡çº§
- The Merge åœ¨ 2022 å¹´ 9 æœˆ 15 æ—¥ä¸Šçº¿ï¼Œå°†å…±è¯†å±‚æœºåˆ¶åˆ‡æ¢ä¸º PoSã€‚ç„¶å PoS å…±è¯†å±‚åˆ†å¼€æ”¾åœ¨äº†ä¸€ä¸ªæ–°çš„ Beacon Chain Layerï¼Œæœ‰è‡ªå·±çš„ p2p ç½‘ç»œå’Œé€»è¾‘ã€‚Beacon Chain ä» 2020 å¹´ 12 æœˆ 1 å·å°±å¼€å§‹è¿è¡Œå’Œæµ‹è¯•ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆé—®é¢˜ã€‚

# 2025.02.09

å¼€å§‹å­¦ä¹ å»å¹´ EPFsg çš„èµ„æ–™ï¼šhttps://epf.wiki/#/eps/week0

## Week0

[Merkle Tress](https://ethereum.org/en/developers/docs/data-structures-and-encoding/patricia-merkle-trie/)

æ‰€æœ‰ä»¥å¤ªåŠç›®å‰çš„æ•°æ®åŒ…æ‹¬ all accountsã€balances å’Œ smart contractsï¼ˆï¼Ÿåˆçº¦æ˜¯æ€ä¹ˆç”¨ Merkle Tree å­˜å‚¨çš„ï¼‰ä½¿ç”¨äº† Merkle Tree è¿›è¡Œç¼–ç ã€‚ä¸»è¦å¥½å¤„æ˜¯ä¸€ä¸ª root value å¯ä»¥ç”¨äºéªŒè¯æ•°æ®ã€‚

ä»¥å¤ªåŠæ•°æ®ç»“æ„æ˜¯ modified Merkle-Patricia Trieï¼Œä½¿ç”¨äº† PATRICIA æ¥å®ç°é«˜æ•ˆæ•°æ®è¯»å–ã€‚â€œPatriciaâ€éƒ¨åˆ†ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘èŠ‚ç‚¹é«˜åº¦ã€èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå°†é‡å¤å‰ç¼€åˆå¹¶åˆ°åŒä¸€ä¸ªè·¯å¾„ä¸Šã€‚

Merkle Tree æ˜¯ä¸åŒ…å«æ•°æ®çš„ï¼Œè€Œæ˜¯å¯¹æ•°æ®è¿›è¡Œ hash ç„¶åé“¾æ¥èµ·æ¥æˆä¸ºä¸€æ£µæ ‘ï¼Œç„¶åé€šè¿‡æäº¤ä»å¶å­èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„ä¸€æ¡ hash è·¯å¾„æ¥ç”Ÿæˆæˆ–è€…éªŒè¯ä¸€ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨æˆ–è€…è¢«ç¯¡æ”¹ã€‚

åœ¨ä»¥å¤ªåŠä¸­ï¼Œç”¨ MPT æ¥ä¿å­˜â€œä¸–ç•ŒçŠ¶æ€ï¼ˆå…¨å±€è´¦æˆ·çš„ä½™é¢ã€åˆçº¦å­˜å‚¨ç­‰ï¼‰â€ã€‚æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šå¯¼è‡´ç›¸åº”çš„ MPT å˜åŒ–ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ ¹å“ˆå¸Œï¼ˆstate rootï¼‰ã€‚

trie æ˜¯ä¸€ç§ç±»å‹çš„ treeï¼ŒåŒ…æ‹¬ prefix tree ç­‰ï¼Œå¸¦æœ‰ä¸€äº›ç‰¹æ®Šé€»è¾‘çš„ treeã€‚

# 2025.02.10

å¯¹äº radix tree è€Œè¨€ï¼Œé€šè¿‡ root hash çš„å­˜å‚¨æŸ¥è¯¢ï¼Œæ˜¯ä¼šé€šè¿‡ key-value çš„æ–¹å¼ï¼Œå°†åºåˆ—åŒ–èŠ‚ç‚¹æ•°æ®å­˜å‚¨åˆ°äº†æŸä¸ªåœ°æ–¹ï¼Œè¿™æ ·å¯ä»¥æŸ¥å‡ºæ¥æ•´ä¸ªæ ‘ã€‚æ‹¿åˆ°çš„èŠ‚ç‚¹æ•°æ®ååºåˆ—åŒ–ï¼Œä¾‹å¦‚ Ethereum çš„ RLPï¼Œç„¶åå¯ä»¥æ‹¿åˆ°æ ¹èŠ‚ç‚¹å¯¹åº”çš„å®Œæ•´ç»“æ„ï¼ŒåŒ…æ‹¬å­èŠ‚ç‚¹ã€å‰ç¼€ä¿¡æ¯ç­‰ã€‚ç„¶åç»§ç»­é€’å½’è°ƒç”¨æŸ¥è¯¢å­èŠ‚ç‚¹æ•°æ®ï¼Œç›´åˆ°ç›®æ ‡çš„å¶å­èŠ‚ç‚¹ã€‚æ„Ÿè§‰å¦‚æœæ ‘çš„å±‚çº§å¤ªæ·±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å°½é‡æ‰å¹³ï¼Œç„¶åæ¯ä¸ªæ ‘å¶å­èŠ‚ç‚¹ä¹Ÿä¸è¦å¤ªå¤šã€‚

```
   def update(node_hash, path, value):
        curnode = db.get(node_hash) if node_hash else [ NULL ] * 17
        newnode = curnode.copy()
        if path == '':
            newnode[-1] = value
        else:
            newindex = update(curnode[path[0]], path[1:], value)
            newnode[path[0]] = newindex
        db.put(hash(newnode), newnode)
        return hash(newnode)
```

æ›´æ–° radix æ ‘çš„æ“ä½œï¼Œå°±æ˜¯é€’å½’è°ƒç”¨éå† `[i_0, i_1 ... i_n, value]` è¿™ä¸ªç»“æ„ï¼Œç„¶åå¯¹æœ€åçš„ä¸€ä¸ª value è¿›è¡Œæ›´æ–°ï¼ŒåŒæ—¶è¿”å›å°†æ•´ä¸ªé“¾è·¯çš„ hash index æ›´æ–°ã€‚

MPT

Radix tries ä¸å¤Ÿé«˜æ•ˆï¼Œæ¯”å¦‚ Ethereum EOA 64 characters é•¿åº¦çš„åœ°å€ï¼Œæ¯æ¬¡ lookup æˆ–è€… delete éƒ½éœ€è¦ 64 stepsã€‚æ‰€ä»¥ Patricia Trie å¼•ç”¨äº†ä¸‹é¢çš„åŠæ³•æ¥è§£å†³é—®é¢˜ï¼š

A node in a Merkle Patricia trie is one of the following:

- NULL (represented as the empty string)
- branch A 17-item node [ v0 ... v15, vt ]
- leaf A 2-item node [ encodedPath, value ]
- extension A 2-item node [ encodedPath, key ]

ç”±äºåœ°å€æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥ä¸­é—´æˆ–è€…æŸæ®µç»“æ„ï¼Œå¯èƒ½å¹¶ä¸éœ€è¦æŒ¨ä¸ªå­—ç¬¦è¿›è¡Œä¸‹é™ï¼Œæ‰€ä»¥é€šè¿‡ encodedPath è¿›è¡Œå­˜å‚¨è·¯å¾„å¿«é€Ÿä¸‹é™ã€‚

Tries in Ethereum

State Trie

There is one global state trie, and it is updated every time a client processes a block. è·¯å¾„æ˜¯ keccak256(ethereumAddress) ç„¶åå€¼æ˜¯ rlp(ethereumAccount)ã€‚å…·ä½“ä¸€ç‚¹ account æ˜¯ `[nonce,balance,storageRoot,codeHash]` è¿™å››ä¸ª itemã€‚

Storage Trie

Storage trie is where all contract data lives. There is a separate storage trie for each account.

Transactions Trie

è·¯å¾„æ˜¯ rlp(transactionIndex)ã€‚There is a separate transactions trie for every block, again storing (key, value) pairs.

Receipts Trie

Every block has its own Receipts trie. A path here is: rlp(transactionIndex).

TODO æå–ä¸€ä¸‹ä¸Šé¢è¿™äº› Trie çš„åŸå§‹æ•°æ®ç»“æ„ï¼Œè¿›è¡Œè§£ç çœ‹çœ‹ã€‚

# 2025.02.11

## https://medium.com/coinmonks/ethereum-data-transaction-trie-simplified-795483ff3929

![image](https://github.com/user-attachments/assets/1cf70c09-1a4a-48d7-b2c8-52e751b38c89)

Light clients are nodes that do not contain entire blockchain data. Instead, they download only the chain of block headers. They cannot take part in block validation however they can access the blockchain in a similar way as the full node does.

![image](https://github.com/user-attachments/assets/2ccae255-5dfd-4268-a2a3-4de3e51c7898)

è½»å®¢æˆ·ç«¯é€šè¿‡è¯»å–å¯¹åº” block çš„ txs ç„¶åè‡ªå·±è®¡ç®— hashes æ¥å¯¹æ¯” root hash æ˜¯ä¸æ˜¯ä¸€æ ·çš„ã€‚é€šè¿‡ merkle tree æ¥å®ç°çš„è¯ï¼Œç„¶åå¹¶ä¸éœ€è¦å…¨éƒ¨çš„ tx å°±å¯ä»¥ï¼Œåªéœ€è¦é€‰æ‹©å‡ ä¸ªå°±å¯ä»¥äº†ã€‚

![image](https://github.com/user-attachments/assets/3c001a97-fe90-47f5-a39c-b6070cea17dd)

é€‰æ‹©è¦éªŒè¯çš„ tx çš„ç›¸å…³ hash å³å¯ï¼Œå› ä¸ºä¸Šå±‚çš„ hash èŠ‚ç‚¹éƒ½æ˜¯è®¡ç®—ç”Ÿæˆçš„ã€‚

TODO è·‘ä¸€ä¸‹ä»£ç  https://github.com/dajuguan/lab/blob/main/eth/randao.py

# 2025.02.12

## https://epf.wiki/#/eps/week1

![image](https://github.com/user-attachments/assets/3635c3a4-c051-4557-a8cb-0621a5b84467)

The Merge çš„è¿‡ç¨‹ï¼Œå…¶å®æ˜¯æ„å»ºäº†ä¸€ä¸ªå¹³è¡Œçš„ Beacon Chain ä¸€ç›´åœ¨è¿è¡Œå’Œæ£€æµ‹ï¼Œä¹‹åæŠŠ execution layer æ¥è¿‡æ¥ã€‚

As hinted above, the main high level components of Ethereum are execution and consensus layer. These are 2 networks which are connected and dependent on each other. Execution layer provides the execution engine, handles user transaction and all state (address, contract data) while consensus implements the proof-of-stake mechanism ensuring security and fault tolerance.

The traditional development cycle for new features or changes is Idea - Research - Development - Testing - Adoption. However, problems might arise at any moment of this cycle resulting in iterating again from the beginning.

The coordination mainly happens via regular calls which are scheduled in the PM repo.

The ideas and proposed changes from the community are coordinated using EIP process. Additionally, there are a few discussion forums. The biggest one discussing core upgrades is https://ethresear.ch. Another forum which is connected to the EIP process and serves for discussion about specific proposals is Ethereum Magicians. Lots of important discussion is also happening on the R&D Discord server (ping us in EPFsg discord to get an invite) and in client team groups. There are also offsites or workshops where many core developers meet in person to speed up the process face to face.

é€šè¿‡ https://github.com/ethereum/pm å­¦ä¹ åˆ°çš„ç¤¾åŒºåè°ƒå’Œç®¡ç†ç»éªŒï¼š

1. é€šè¿‡åˆ›å»º issues + tag æ¥æ”¾è®®é¢˜ã€ä¼šè®®é“¾æ¥ç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚ https://github.com/ethereum/pm/issues/1253 åŒ…æ‹¬å…¨éƒ¨çš„ä¼šè®®ï¼Œä¸ä»…ä»…æ˜¯ ACDE ACDC
2. æä¾›äº†ä¸€ä¸ª Google Calendar æ¥å¿«é€Ÿæ·»åŠ ï¼Œä½†æ˜¯ç›®å‰ä¸çŸ¥é“æ˜¯è‡ªåŠ¨è¿˜æ˜¯äººå·¥ç»´æŠ¤çš„
3. æ¬¢è¿å¤§å®¶é€šè¿‡è¯„è®ºçš„æ–¹å¼ï¼Œæ·»åŠ è®®é¢˜ç­‰
4. å†™æ¸…æ¥šäº†è®®é¢˜å¦‚ä½•æ·»åŠ ã€è°èƒ½å‚åŠ ã€è°ä¸»æŒç­‰
5. ECH æä¾›äº†å­—å¹•ç¨¿ï¼Œç„¶åä¸‹é¢æœ‰ä¸ªå¤§è¡¨å•ï¼Œå¯ä»¥çœ‹åˆ°æ¯æ¬¡ä¼šè®®çš„å½•å±ã€notesã€è®¨è®ºç­‰ç­‰

å¯¹ LXDAO çš„å¯å‘ï¼š

- å¯ä»¥è€ƒè™‘å°†ä¼šè®®é›†ä¸­åœ¨è¿™é‡Œç®¡ç†ï¼Œé¿å…åœ¨è®ºå›å ç”¨å¤§å®¶çš„æ³¨æ„åŠ›
- æä¾›ä¼šè®®çš„é€Ÿè®°å’Œå†…å®¹ç¨¿ï¼Œä½œä¸ºç¤¾åŒºå‘¨æŠ¥çš„å†…å®¹ï¼Œè€Œéæ¯”è¾ƒåˆ¶å¼çš„ï¼Œé‡ç‚¹åœ¨äºå¼•å¯¼å¤§å®¶è®¨è®º

TODO https://notes.ethereum.org/@mikeneuder/rcr2vmsvftv

# 2025.02.13

## https://epf.wiki/#/eps/week2

### https://github.com/ethereum/consensus-specs/blob/dev/specs/deneb/beacon-chain.md#modified-process_execution_payload

```
class ExecutionPayload(Container):
    # Execution block header fields
    parent_hash: Hash32 # ä¸Šä¸€ä¸ªåŒºå—çš„ hashï¼Œè¿èµ·æ¥
    fee_recipient: ExecutionAddress  # 'beneficiary' in the yellow paper æ‰§è¡Œå±‚ä¸­ï¼Œæ˜¯åŒºå—æäº¤è€…çš„åœ°å€
    state_root: Bytes32
    receipts_root: Bytes32
    logs_bloom: ByteVector[BYTES_PER_LOGS_BLOOM] # ç”¨äºæ—¥å¿—è¿‡æ»¤çš„ bloom è¿‡æ»¤å™¨ï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾æ—¥å¿—
    prev_randao: Bytes32  # 'difficulty' in the yellow paper
    block_number: uint64  # 'number' in the yellow paper
    gas_limit: uint64
    gas_used: uint64
    timestamp: uint64
    extra_data: ByteList[MAX_EXTRA_DATA_BYTES]
    base_fee_per_gas: uint256
    # Extra payload fields
    block_hash: Hash32  # Hash of execution block
    transactions: List[Transaction, MAX_TRANSACTIONS_PER_PAYLOAD]
    withdrawals: List[Withdrawal, MAX_WITHDRAWALS_PER_PAYLOAD] # ç›®å‰åŒºå—çš„ææ¬¾åˆ—è¡¨
    blob_gas_used: uint64  # [New in Deneb:EIP4844]
    excess_blob_gas: uint64  # [New in Deneb:EIP4844]
```

éœ€è¦è¿›è¡Œèƒ½åŠ›æ‰©å±•å’Œæ•°æ®å¢åŠ ï¼Œå°±æ˜¯é€šè¿‡ç±»ä¼¼ EIP4844 è¿™æ ·çš„æ ‡å‡†ï¼Œåˆ›å»ºæ–°çš„æ ‡å‡†ï¼Œç„¶åå®¢æˆ·ç«¯æ¥å®ç°è¯»å–å’Œä¿å­˜è®°å½•ã€‚

çœŸå®çš„ä¿¡æ¯å’Œæ•°æ®ï¼š

![image](https://github.com/user-attachments/assets/185dcd23-b49a-4980-8c9a-f6f66d365543)

![image](https://github.com/user-attachments/assets/51da5284-ff7a-44af-8b53-b286f9e35555)

![image](https://github.com/user-attachments/assets/7861ddc2-dc22-4da3-84aa-406d639f2eda)

logs_bloom çš„å·¥ä½œåŸç†ï¼š

- logs_bloom æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ä½æ•°ç»„ï¼Œé€šå¸¸ä¸º256å­—èŠ‚ï¼Œå³2048ä½ã€‚
- å½“ä¸€ä¸ªæ–°çš„æ—¥å¿—è¢«æ·»åŠ åˆ°åŒºå—ä¸­æ—¶ï¼Œè®¡ç®—è¯¥æ—¥å¿—çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚3ä¸ªï¼‰ç”Ÿæˆå¤šä¸ªå“ˆå¸Œå€¼ã€‚
- å°†è¿™äº›å“ˆå¸Œå€¼æ˜ å°„åˆ°logs_bloomçš„ä½æ•°ç»„ä¸­ï¼Œå°†å¯¹åº”çš„ä½è®¾ç½®ä¸º1ã€‚
- æŸ¥è¯¢æŸä¸ªæ—¥å¿—æ˜¯å¦å­˜åœ¨äºæŸä¸ªåŒºå—çš„æ—¶å€™ï¼Œåªéœ€è¦è®¡ç®—æ—¥å¿—çš„ hashï¼Œç„¶åå¿«é€Ÿæ£€æŸ¥ logs_bloom çš„å¯¹åº”çš„ä½ç½®æ˜¯å¦å…¨éƒ¨ä¸º 1ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ—¥å¿—å¯èƒ½åœ¨å½“å‰åŒºå—ã€‚å¯èƒ½ä¼šå­˜åœ¨è¯¯æŠ¥
- é€šè¿‡è¿™ä¸ªï¼Œå¯ä»¥å¿«é€Ÿè¿‡æ»¤ä¸åŒ…å«ç‰¹å®šæ—¥å¿—çš„åŒºå—ï¼Œæé«˜æ£€ç´¢æ•ˆç‡ï¼Œæ¯”å¦‚æŸ¥è¯¢ event å‘ç”Ÿåœ¨å“ªäº›åŒºå—ï¼Œä»è€Œä»…ä»…åŠ è½½å’Œå¤„ç†ç›¸å…³åŒºå—

TODO Hackerscan å¯ä»¥åŠ å…¥æŸ¥çœ‹åŸå§‹åŒºå—ä¿¡æ¯çš„åŠŸèƒ½ï¼Œæ²¡æœ‰æ‰¾åˆ° logs_bloom çš„åŸå§‹æ•°æ®

TODO Contract Internal Transactions æ˜¯ä»€ä¹ˆï¼Ÿè·Ÿ Block çš„ transactions åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

TODO æ˜å¤©æŠŠæ•´ä¸ªåŒºå—çš„æ‰€æœ‰ä¿¡æ¯å’Œå†…å®¹è¿‡ä¸€ä¸‹ https://etherscan.io/block/21833528 https://eth.blockscout.com/block/21833528?tab=index

TODO randao
TODO withdrawals ææ¬¾å·¥ä½œåŸç†ï¼Ÿ

# 2025.02.14

## https://epf.wiki/#/eps/week2

LevelDB is a fast key-value storage library written at Google that provides an ordered mapping from string keys to string values.

ä¸€ä¸ªåŸå§‹çš„ block æ•°æ®ï¼ˆdenebï¼‰ï¼š

```
{
  "slot": "8631513",
  "proposer_index": "1124880",
  "parent_root": "0x5a585679198d1bae7f337f987496d22c9f0db95fb1bcd4d8069a74be0e76a5ae",
  "state_root": "0x855b6335a3b955443fb14111738881680817a2de050a1e2534904ce2ddd8e5e0",
  "body": {
    "randao_reveal": "0x8c290463d6e68154d171deeca3a4d8d8fa276c72e9c34094f8b6bf89e551e99d63162e362a936b628af4840d69b10c24191e892d0a282bb5358a5669f44e42b627ebeb63fd6467c7aad62636a348b5f4edfb8ce01650e4d079339d9dc5700f05",
    "eth1_data": {
      "deposit_root": "0x636ab1747c976fe08cf337b437ccbb5f543e0d0c6b5d70097c3ab7737c1748d5",
      "deposit_count": "1342638",
      "block_hash": "0x429813f0390a9e104740e8a24ebb83ac03929dff4a9702385f2bf24391ba754b"
    },
    "graffiti": "0x526f636b617761795820496e6672610000000000000000000000000000000000",
    "proposer_slashings": [],
    "attester_slashings": [],
    "attestations": [
      {
        "aggregation_bits": "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f",
        "data": {
          "slot": "8631512",
          "index": "19",
          "beacon_block_root": "0x5a585679198d1bae7f337f987496d22c9f0db95fb1bcd4d8069a74be0e76a5ae",
          "source": {
            "epoch": "269733",
            "root": "0x508880ef7fe7cac1a601bcb00868cc41a523497b34d85fb71dc338f891eb049b"
          },
          "target": {
            "epoch": "269734",
            "root": "0x89926ca6add36803c7239a78f78af0fb91df932f8af2ac34d4cf89998ea3ec68"
          }
        },
        "signature": "0x903146f136e4df8200be0229eb96bc9a2409d04763df61ebba51f54cfbd9eca2c88274cb94828c2705bff1454c50322e03372883c2dd47ee329cd17a3653f44314fa8693c73fa2097f622e7f2e163f7b7cb688aebad93e14c273d406743ec7ad"
      },
      {
        "aggregation_bits": "0xffffffffffbfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f",
        "data": {
          "slot": "8631512",
          "index": "27",
          "beacon_block_root": "0x5a585679198d1bae7f337f987496d22c9f0db95fb1bcd4d8069a74be0e76a5ae",
          "source": {
            "epoch": "269733",
            "root": "0x508880ef7fe7cac1a601bcb00868cc41a523497b34d85fb71dc338f891eb049b"
          },
          "target": {
            "epoch": "269734",
            "root": "0x89926ca6add36803c7239a78f78af0fb91df932f8af2ac34d4cf89998ea3ec68"
          }
        },
        "signature": "0x99d3c97b5036025d1b30ac32efd469a815269e2575a7525b1cc8323db85556aef7af7464d965ab9b6ee1804005436a0b05faf870cb213dff04552ddffcfe355987d35201e58dce3897c0de27a19016321fba9ac346452755ae9340f60cea895d"
      }
    ],
    "deposits": [],
    "voluntary_exits": [],
    "sync_aggregate": {
      "sync_committee_bits": "0xfffffffffffffffeffffffffffffffffffbffffffffffffffffffdfffffffbffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "sync_committee_signature": "0xae953c135ac95f1cd669a8caf9e89770483bdf3dbf138b2dfdd76198e9baac00ab4d807b518ebfa9e665a8a78dab9c210ff7a073b85fef1e75ccd49f0747c73fe850f9e87c63985f9bf5d795c28474c4ea67716e194a320382c6d9e560aebc9e"
    },
    "execution_payload": {
      "parent_hash": "0x5cb0f2822e542e2c6fbc0099aa8f996509c178bfaa634e04b728add8da42c65d",
      "fee_recipient": "0x95222290dd7278aa3ddd389cc1e1d165cc4bafe5",
      "state_root": "0xca4e0ab986d29ee5bddd8b4b9d9481e90d7bbd1ce7ee9e0d077c89ba03cdcf32",
      "receipts_root": "0x09fdee17a2dafb2328798f9e47b44e50a5a8e5d9951929afa51f70fc222846c2",
      "logs_bloom": "0xbffdca4be5945bfbba8a8ed5eadb7ff2dcefce7f6cb67b94cf81ad38dc9a943b76e541efe10b2768ded9de385ffdd9596b79a4ecffbafd407ffca3453cff2d9ebf7f57ffe3069abb7eebf66eddc460ecd9ef7ded9c67de1b1ccb7ce9e9f9cf7e3fdcdc2fbe974ae2be4cd35271d47b5bda4459fde93d3f0bead5c558997b18386ef38ff77e234f6eb7cda7d47bee4ab6b273b8f9ffb37d5be6ffb7dac9ffbd36ffc6eb33ffaa7f832f264dc5f9966fed1fc7c0fdf6fb719e7fb39b6e38dddfe3defbde6a7668fb7f2166e79fb8df91adbd73545fbf3ae59caeedf7df6937fc5039fafaff21fd720fd9f5d6a3e85798e0d7abde86f3a6afff6383fb0beefcdc0f",
      "prev_randao": "0xb48f684132ba484557c07ea6964d6b3841607a44a540a24dd31cbbccb14f06a5",
      "block_number": "19431837",
      "gas_limit": "30000000",
      "gas_used": "28138718",
      "timestamp": "1710402179",
      "extra_data": "0x6265617665726275696c642e6f7267",
      "base_fee_per_gas": "44330915133",
      "block_hash": "0x4cf7d9108fc01b50023ab7cab9b372a96068fddcadec551630393b65acb1f34c",
      "transactions": [
        "0x02f904b40183222e6b80850a5254153d8303adab946b75d8af000000e20b7a7ddf000ba900b4009a808509bafeda9db83a7f381ce270557c1f68cfb577b856766310bf8b47fd9ce8d11a5b113a7a922aea89288d8c91777beecc68df4a17151df102bbfc4140e8c3d5e806f90407f8bc94e485e2f1bab389c08721b291f6b59780fec83fd7f8a5a0ddf68a16e33fcf794c93d34148c2e2c4391f4f3f27ff7a52703ddbcdb5c569f0a0b39e9ba92c3c47c76d4f70e3bc9c3270ab78d2592718d377c8f5433a34d3470aa09edbdabec2e16ca41f1efb3c19f5f3d18c604847272628636ea866af352b901ca09bb3e24e1534bce24e9896f3377327d742d6c1d430477b7ebc070c2eb64e3147a0000000000000000000000000000000000000000000000000000000000000000bf859941ce270557c1f68cfb577b856766310bf8b47fd9cf842a0b39e9ba92c3c47c76d4f70e3bc9c3270ab78d2592718d377c8f5433a34d3470aa094fe3377ad59f5716da176e7699b06460ce5b4208f8313f3d26113b1cf3d3170f8dd947054b0f980a7eb5b3a6b3446f3c947d80162775cf8c6a00000000000000000000000000000000000000000000000000000000000000007a00000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000000aa0000000000000000000000000000000000000000000000000000000000000000ca00000000000000000000000000000000000000000000000000000000000000008a00000000000000000000000000000000000000000000000000000000000000006f85994c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2f842a0051234925bf172ac8e2ccbd292c65330169d67445a0966551f13a5df19bb9321a012231cd4c753cb5530a43a74c45106c24765e6f81dc8927d4f4be7e53315d5a8f8bc94a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48f8a5a0d2764b6d304d6875dc1632274f53a7d27047ae66fe20f57cce9fb878c86ccdeaa010d6a54a4754c8869d6886b5f5d7fbfa5b4522237ea5c60d11bc4e7a1ff9390ba07050c9e0f4ca769c69bd3a8ef740bc37934f8e2c036e5a723fd8ee048ed3f8c3a00000000000000000000000000000000000000000000000000000000000000001a0154bb98efc83b034ad81fbf23cc88c9737739df170c146ea18e8113dac893665d69443506849d7c04f9138d1a2050bbf3a0c054402ddc0f8dd947a922aea89288d8c91777beecc68df4a17151df1f8c6a00000000000000000000000000000000000000000000000000000000000000008a00000000000000000000000000000000000000000000000000000000000000006a00000000000000000000000000000000000000000000000000000000000000007a00000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000000aa0000000000000000000000000000000000000000000000000000000000000000c80a0bc7a0020d84346ad4ffdce908fbf7291f7f7f251a6381bd43583f02606a05471a04acbaeb9886f864bc654123665b91e527623fd2a9225e1371e061ecf5fa4dbf8",
        "0x02f9017501829a308502540be400850f8839d18083061a80947a250d5630b4cf539739df2c5dacb4c659f2488d80b9010438ed17390000000000000000000000000000000000000003221ceed0394f7b8ef2b12118000000000000000000000000000000000000000000000000213a0fe9640f2a2d00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000001d283807630ffb876a5d78b8e0788e491449f2410000000000000000000000000000000000000000000000000000018e3bee84e100000000000000000000000000000000000000000000000000000000000000020000000000000000000000001ce270557c1f68cfb577b856766310bf8b47fd9c000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2c001a036e76fbcbc86dd2d6fe3d37e65ca3e83aec7259a850b28686fece7105c1d2a24a06c4b4d44d359c9360b8ebf2554eacae621824441f00d99275be3bfd01f554239",
        "0x02f87201830bbc2a80850a5254153d827d0094388c818ca8b9251b393131c08a736a67ccb19297880185a6d6be627f3280c080a038cbd7a4589d49f061b88da94c6d16e085faed4ea61f60a744d781bea95862a3a061eb4b1dc235a3fdb04c589150326d7e49089439428c22ced7bc7ddb559edd37"
      ],
      "withdrawals": [
        {
          "index": "38350022",
          "validator_index": "171011",
          "address": "0x8626354048f90faafc212c07ec7f3613406b1b32",
          "amount": "18545672"
        },
        {
          "index": "38350023",
          "validator_index": "171012",
          "address": "0x8626354048f90faafc212c07ec7f3613406b1b32",
          "amount": "18561699"
        }
      ],
      "blob_gas_used": "131072",
      "excess_blob_gas": "0"
    },
    "bls_to_execution_changes": [],
    "blob_kzg_commitments": [
      "0x97d62d4572935295f909f243714201d9221215bfcc91af6546d28d2e52040577a77957256c530ca25974f6a814511b1a"
    ]
  }
}
```

# 2025.02.17

å¼€å§‹è·Ÿéšå®˜æ–¹çš„ EPFsg é«˜å¼ºåº¦å­¦ä¹  https://epf.wiki/#/eps/introï¼Œå…¶å®å°±æ˜¯å¤ä¹ ï¼Œä½†æ˜¯è¦ç¡®ä¿ä¸€å¤©èƒ½å®Œæˆä¸€ä¸ªä¸»é¢˜ã€‚

ä»Šå¤©æˆ‘æŠŠ Execution Layer W2 çš„æ”¶å°¾å®Œæˆæ‰ã€‚

## https://epf.wiki/#/eps/week2

çœ‹äº†ä¸‹è§†é¢‘ï¼Œå…¶å®æ•´ä¸ªæ‰§è¡Œå±‚çš„è¿è¡Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ— éå°±æ˜¯å»å°† envã€txã€state ç­‰è¿›è¡Œæ‰§è¡Œå’ŒéªŒè¯ï¼Œç¡®ä¿ gas æ²¡æœ‰è¶…å‡ºï¼Œç„¶åå‡ºå—ç­‰ã€‚ç„¶åä¿®æ”¹åˆ° stateDB ä¸Šé¢ï¼Œç›¸å½“äºä¸€ä¸ªçŠ¶æ€å‡½æ•°è½¬ç§»ã€‚

åœ¨ txpool.Pop() çš„æ—¶å€™ï¼Œå…ˆæŒ‰ç…§ paying gas to the builder è¿›è¡Œæ’åºï¼Œç„¶åå–å‡ºæ¥æœ€å¤§æ”¶ç›Šçš„ txã€‚

EL ä¼šåˆ¤æ–­å¦‚æœ tx æ˜¯ invalid å°±ä¸ä¼šå‘åˆ° CL äº†ï¼Œåªæ˜¯è´Ÿè´£æ‰“åŒ…ç­‰ã€‚åŠ å¯† mempool æœ‰å¾…è§£å†³ã€‚

æ‰“ç®—æŠŠ go-ethereum çš„ä»£ç è·‘èµ·æ¥ï¼Œç›´æ¥ debug çœ‹æºä»£ç ï¼Œæš‚æ—¶å¡ä½äº†ï¼Œå¯¹ Go è¯­è¨€ä¸ç†Ÿæ‚‰ã€‚

# 2025.02.18

å› ä¸ºåé¢çš„ä¸€äº›å®ç°é€»è¾‘ç­‰æƒ³ç›´æ¥çœ‹ go-ethereum ä»£ç äº†ï¼Œæ‰€ä»¥èŠ±äº†ä¸€äº›æ—¶é—´ç ”ç©¶å¦‚ä½•ä½¿ç”¨ dlv æ¥ debug goã€‚ç»“æœå‘ç° VSCode é»˜è®¤å°±æ”¯æŒé’ˆå¯¹ Unit Test çš„ debugï¼Œåœ¨å¯ä»¥æ‰§è¡Œçš„æ–¹æ³•ä¸Šé¢ä¼šæœ‰ debug test æŒ‰é’®ï¼Œä¸‹æ–­ç‚¹ï¼Œç‚¹ä¸€ä¸‹å°±å¯ä»¥è¿›å…¥ debug æ¨¡å¼ã€‚å®åœ¨æ˜¯å¤ªé«˜çº§å¤ªç®€å•äº†ã€‚

![image](https://github.com/user-attachments/assets/54ce4bcd-d4cd-480c-b6f3-18c73e7fbdcf)


ç„¶åé€šè¿‡ AI å·¥å…·å¸®å¿™æ‰¾åˆ°å¯¹åº”çš„åŠŸèƒ½ï¼Œç›´æ¥å°±å¯ä»¥å¼€å§‹ä¸‹æ–­ç‚¹ debug çœ‹çœ‹å…·ä½“çš„å®ç°é€»è¾‘ï¼š

![image](https://github.com/user-attachments/assets/11a14590-3a2c-4f2d-acc2-967d8268f536)

# 2025.02.19

## https://epf.wiki/#/eps/week2

EL ä¸»è¦å°±æ˜¯ Block éªŒè¯å’Œ Block æ„å»ºï¼ŒéªŒè¯åŒ…æ‹¬ state è½¬ç§»ã€evm æ‰§è¡Œã€EIP ç­‰æ–°çš„ gas é€»è¾‘ç­‰ã€æ„å»º blockï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªåŸºäº p2p çš„ tx poolã€‚

çŠ¶æ€è½¬ç§»å‡½æ•°åœ¨ [state_processor.go](https://github.com/ethereum/go-ethereum/blob/master/core/state_processor.go#L57) çš„ Process æ–¹æ³•é‡Œé¢ï¼Œä¸»è¦ç”¨é€”éªŒè¯ merkle rootsã€gas limitã€timestamp ç­‰ã€‚Debug ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œä¸€äº›è§‚å¯Ÿå¦‚ä¸‹ï¼š

// Process returns the receipts and logs accumulated during the process and
// returns the amount of gas that was used in the process. If any of the
// transactions failed to execute due to insufficient gas it will return an error.


![image](https://github.com/user-attachments/assets/8af10a0e-2572-452a-94be-2a55e5871ea9)

è¿™ä¸ªå°±æ˜¯ GO é‡Œé¢å¯¹äº hash çš„å­˜å‚¨æ–¹å¼ï¼Œä¸€èˆ¬æ˜¯ 32 bytesï¼Œæˆ–è€…æ˜¯ä»¥ä¸€ä¸ªæ‹¼æ¥ 16 è¿›åˆ¶å­—ç¬¦ä¸² `|\xbex\x8e\x04\xd1M\xeeD}\x83Cj\xc4s\x1d\xa6\bt\xe6\v?\x85\xcf\xcbI\x8b\xb0\xe4\xdd\xf33` è¿™æ ·ã€‚

![image](https://github.com/user-attachments/assets/f832d6e2-4495-46b1-ad8e-65bb910f9ac3)

The DAO äº‹ä»¶åå¤æ‹‰å‡ºæ¥è¢«è®¨è®ºï¼Œæ—©å·²ä»ä¸€ä¸ªç®€å•çš„é—®é¢˜ä¸Šå‡åˆ°äº†ç¤¾ä¼šå­¦å’Œå“²å­¦å±‚é¢ï¼ŒEthereum ä¹Ÿåˆ†å‰æˆäº† ETH å’Œ ETCï¼Œå…¶å®å®é™…ä¸ŠèƒŒåçš„ä»£ç å°±æ˜¯è¿™ä¹ˆæœ´å®æ— åçš„ä¸€å †ç¡¬ç¼–ç ï¼šéå†è¿™äº›é»‘å®¢é’±åŒ…ï¼ŒæŠŠä»–ä»¬çš„ä½™é¢è½¬ç§»åˆ° refund åˆçº¦åœ°å€ã€‚ğŸ¤£

var tracingStateDB = vm.StateDB(statedb) TODO æœ‰ç©ºç ”ç©¶ä¸‹ StateDB çš„åº•å±‚å­˜å‚¨æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Œä¼¼ä¹æ˜¯ LevelDBã€‚

ä¼šå…ˆæ„å»ºä¸€ä¸ª EVM Context æ¥ç»§ç»­æ‰§è¡Œï¼ŒåŒ…æ‹¬ä¸€äº›åŸºæœ¬é…ç½®å‚æ•°ï¼š

```
vm.BlockContext{
		CanTransfer: CanTransfer,
		Transfer:    Transfer,
		GetHash:     GetHashFn(header, chain),
		Coinbase:    beneficiary,
		BlockNumber: new(big.Int).Set(header.Number),
		Time:        header.Time,
		Difficulty:  new(big.Int).Set(header.Difficulty),
		BaseFee:     baseFee,
		BlobBaseFee: blobBaseFee,
		GasLimit:    header.GasLimit,
		Random:      random,
	}
```

ç„¶ååˆ›å»ºä¸€ä¸ª evm è¿›è¡Œæ‰§è¡Œï¼š`evm := vm.NewEVM(context, tracingStateDB, p.config, cfg)`ã€‚

![image](https://github.com/user-attachments/assets/16219e97-b87d-402f-b209-e927f5559f71)

é¢„ç¼–è¯‘åˆçº¦çš„å®ç°å°±æ˜¯åœ¨ evm è¿›è¡ŒåŠ è½½ï¼Œæ ¹æ®ç›¸åº”çš„å‚æ•°ï¼Œæ‰¾åˆ°å¯¹åº”çš„åˆçº¦ç¼–è¯‘åˆ° EVM é‡Œé¢ã€‚å…·ä½“å†…å®¹åœ¨ contracts.go æ–‡ä»¶ã€‚

```
var PrecompiledContractsPrague = PrecompiledContracts{
	common.BytesToAddress([]byte{0x01}): &ecrecover{},
	common.BytesToAddress([]byte{0x02}): &sha256hash{},
	common.BytesToAddress([]byte{0x03}): &ripemd160hash{},
	common.BytesToAddress([]byte{0x04}): &dataCopy{},
	common.BytesToAddress([]byte{0x05}): &bigModExp{eip2565: true},
	common.BytesToAddress([]byte{0x06}): &bn256AddIstanbul{},
	common.BytesToAddress([]byte{0x07}): &bn256ScalarMulIstanbul{},
	common.BytesToAddress([]byte{0x08}): &bn256PairingIstanbul{},
	common.BytesToAddress([]byte{0x09}): &blake2F{},
	common.BytesToAddress([]byte{0x0a}): &kzgPointEvaluation{},
	common.BytesToAddress([]byte{0x0b}): &bls12381G1Add{},
	common.BytesToAddress([]byte{0x0c}): &bls12381G1MultiExp{},
	common.BytesToAddress([]byte{0x0d}): &bls12381G2Add{},
	common.BytesToAddress([]byte{0x0e}): &bls12381G2MultiExp{},
	common.BytesToAddress([]byte{0x0f}): &bls12381Pairing{},
	common.BytesToAddress([]byte{0x10}): &bls12381MapG1{},
	common.BytesToAddress([]byte{0x11}): &bls12381MapG2{},
}
```

æ¯æ¬¡å‡çº§è¿›è¡Œæ·»åŠ ï¼Œå¿…é¡»è¦ä¿æŒå‘å‰å…¼å®¹ï¼Œåˆ†é…ä¸€ä¸ªå›ºå®šçš„ä½ç½®æ–¹ä¾¿åˆçº¦è°ƒç”¨ã€‚å®ç°çš„æ¥å£æ˜¯ï¼š

```
type PrecompiledContract interface {
	RequiredGas(input []byte) uint64  // RequiredPrice calculates the contract gas use
	Run(input []byte) ([]byte, error) // Run runs the precompiled contract
}
```

æ¯”å¦‚ ecrecover çš„å®ç°å°±æ˜¯ï¼š

```
// ecrecover implemented as a native contract.
type ecrecover struct{}

func (c *ecrecover) RequiredGas(input []byte) uint64 {
	return params.EcrecoverGas
}

func (c *ecrecover) Run(input []byte) ([]byte, error) {
	const ecRecoverInputLength = 128

	input = common.RightPadBytes(input, ecRecoverInputLength)
	// "input" is (hash, v, r, s), each 32 bytes
	// but for ecrecover we want (r, s, v)

	r := new(big.Int).SetBytes(input[64:96])
	s := new(big.Int).SetBytes(input[96:128])
	v := input[63] - 27

	// tighter sig s values input homestead only apply to tx sigs
	if !allZero(input[32:63]) || !crypto.ValidateSignatureValues(v, r, s, false) {
		return nil, nil
	}
	// We must make sure not to modify the 'input', so placing the 'v' along with
	// the signature needs to be done on a new allocation
	sig := make([]byte, 65)
	copy(sig, input[64:128])
	sig[64] = v
	// v needs to be at the end for libsecp256k1
	pubKey, err := crypto.Ecrecover(input[:32], sig)
	// make sure the public key is a valid one
	if err != nil {
		return nil, nil
	}

	// the first byte of pubkey is bitcoin heritage
	return common.LeftPadBytes(crypto.Keccak256(pubKey[1:])[12:], 32), nil
}
```

æ‰€ä»¥è¿™é‡Œçš„å®ç°è¿˜æŒºé‡è¦çš„ï¼Œä¸èƒ½æœ‰é—®é¢˜ï¼Œä»¥åä¹Ÿä¸èƒ½éšä¾¿æ”¹ã€‚ç”±äºç›´æ¥åœ¨å®¢æˆ·ç«¯ä¸Šæ‰§è¡Œï¼Œgas æ¶ˆè€—æ¯”è¾ƒä½ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ä¸èƒ½åŠ å…¥å¤ªå¤šï¼Œå¤ªå¤šçš„è¯ä¼šå¯¼è‡´å®¢æˆ·ç«¯ä»£ç å’Œå¤æ‚åº¦å¢åŠ ã€‚

TODO debug åˆ° 	evm := vm.NewEVM(context, tracingStateDB, p.config, cfg) äº†ï¼Œæ˜å¤©ç»§ç»­ debug å®Œã€‚



---

EVM ä¸»è¦æ˜¯ä¸€ä¸ª stack machineã€‚The Ethereum VM is a stack-based, big-endian VM with a word size of 256-bits and is used to run the smart contracts on the Ethereum blockchain.
Smart contracts are just like regular accounts, except they run EVM bytecode when receiving a transaction, allowing them to perform calculations and further transactions.
Transactions can carry a payload of 0 or more bytes of data, which is used to specify the type of interaction with a contract and any additional information.

TODO EVM æ˜¯å¦‚ä½•å°† EVM bytecode ä¸€æ­¥æ­¥æ‰§è¡Œçš„ï¼ŸDebug ä¸€ä¸ªç®€å•çš„




p2p ä¸»è¦æ˜¯ä¸‰ä»¶å·¥ä½œï¼ŒtåŒ…æ‹¬å†å²æ•°æ®ã€pending txsã€çŠ¶æ€åŒæ­¥ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ snap æ–‡ä»¶çš„æ–¹å¼å¿«é€Ÿçš„åŒæ­¥çŠ¶æ€ã€‚


fork äº†ä¸€ä¸ªå­¦ä¹ æ³¨è§£ç‰ˆæœ¬çš„ go-ethereum ä»“åº“ https://github.com/brucexu-eth/go-ethereum/commit/16ab6c3351a9cd5f612633409e7828876e1a37b0 æ–¹ä¾¿å¤§å®¶ä½¿ç”¨ï¼Œä½¿ç”¨ cursor ç”Ÿæˆè‡ªå·±æƒ³è¦çš„ unit test è¿›è¡Œ debugï¼Œå¾ˆæ–¹ä¾¿ã€‚

# 2025.02.20

ç»§ç»­ debug EL çš„ä»£ç ã€‚

```
// IsVerkle returns whether time is either equal to the Verkle fork time or greater.
func (c *ChainConfig) IsVerkle(num *big.Int, time uint64) bool {
	return c.IsLondon(num) && isTimestampForked(c.VerkleTime, time)
}
```

ä½¿ç”¨æ£€æµ‹æ—¶é—´çš„æ–¹å¼ä½¿å‡çº§ç”Ÿæ•ˆï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éƒ½æ˜¯æå‰æ›´æ–°å’Œéƒ¨ç½²çš„ï¼Œå®šå¥½åŒºå—æ—¶é—´ä¸Šçº¿ã€‚è¿™é‡Œé¢ä¼°è®¡æœ‰ä¸€äº›åè°ƒå·¥ä½œã€‚

Go debug çš„æ—¶å€™ï¼Œå¦‚æœè¦æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œéœ€è¦åœ¨ debug console é‡Œé¢ä½¿ç”¨ `call value.String()` è¿™æ ·çš„æ–¹å¼ï¼Œæ·»åŠ  callã€‚

```
evm := &EVM{
	Context:     blockCtx,
	StateDB:     statedb,
	Config:      config,
	chainConfig: chainConfig,
	chainRules:  chainConfig.Rules(blockCtx.BlockNumber, blockCtx.Random != nil, blockCtx.Time),
	jumpDests:   make(map[common.Hash]bitvec),
}
```

è¿™ä¸ª jumpDests è¿˜æŒºæœ‰æ„æ€çš„ï¼Œæ˜¯ EVM é‡Œé¢ç”¨äºä¼˜åŒ– JUMP/JUMPI æŒ‡ä»¤æ‰§è¡Œçš„ç¼“å­˜ï¼Œå…ˆæŠŠåˆçº¦ä»£ç é‡Œé¢æœ‰æ•ˆçš„è·³è½¬ç›®æ ‡ä½ç½®è¿›è¡Œè®°å½•ï¼Œæ–¹ä¾¿è¿›è¡Œè·³è½¬ã€‚bitvec ä½å‘é‡ç”¨äºæ ‡è®°ä»£ç å“ªäº›ä½ç½®æ˜¯æœ‰æ•ˆçš„è·³è½¬ç›®æ ‡ï¼Œä½†æ˜¯å…·ä½“çš„è¿ç®—é€»è¾‘è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚

![image](https://github.com/user-attachments/assets/8786f08d-d9ec-4992-8afd-49015b6ccf42)

ä¼šæå‰å°† transaction è½¬æ¢æˆ messageï¼Œç„¶å apply åˆ° evm ä¸Šé¢ï¼Œç„¶åå°±åˆ°äº†å…·ä½“çš„æ‰§è¡Œé€»è¾‘ï¼ŒTODO æ˜å¤©ç»§ç»­çœ‹

![Cursor 2025-02-20 19 30 28](https://github.com/user-attachments/assets/d01269a7-5d92-42bd-9a10-c9156fefbf27)


# 2025.02.21

ä»Šå¤©æ­å»ºä¸€ä¸‹ node ç©ç© https://epf.wiki/#/eps/nodes_workshop

å»å¹´è·‘è¿‡ï¼Œæˆ‘çš„ç¬”è®°å’Œå‘½ä»¤ https://github.com/IntensiveCoLearning/ethereum-protocol/blob/main/brucexu.md#52

ä¸‹è½½æœ€æ–°ç‰ˆçš„ï¼Œç„¶åæ‰§è¡Œï¼š

```
# Generate jwtsecret
openssl rand -hex 32 > ./jwt

./geth --holesky --datadir ./geth-data --syncmode snap --http --http.port 8545 --authrpc.jwtsecret ./jwt --authrpc.port 8551

./lighthouse bn --network holesky --execution-endpoint http://localhost:8551 --datadir ./lh-data --execution-jwt ./jwt --http --checkpoint-sync-url https://holesky.beaconstate.ethstaker.cc/
```

ç„¶åç­‰å¾…åŒæ­¥å°±å¯ä»¥äº†ã€‚

![image](https://github.com/user-attachments/assets/1df5ea9c-345c-4982-b46c-46d86878f7f0)


# 2025.02.23

ç»§ç»­ debug processor logic é‡Œé¢çš„ evm å’Œåç»­ tx çš„é€»è¾‘ï¼š

```
func (st *stateTransition) execute() (*ExecutionResult, error) {
	// First check this message satisfies all consensus rules before
	// applying the message. The rules include these clauses
	//
	// 1. the nonce of the message caller is correct
	// 2. caller has enough balance to cover transaction fee(gaslimit * gasprice)
	// 3. the amount of gas required is available in the block
	// 4. the purchased gas is enough to cover intrinsic usage
	// 5. there is no overflow when calculating intrinsic gas
	// 6. caller has enough balance to cover asset transfer for **topmost** call

```

æµ‹è¯•ç”¨ä¾‹æœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹å‚æ•°ç»§ç»­ä¸‹å»ï¼Œç›®å‰ä¼šæŠ¥é”™æ˜¾ç¤º gas ä¸è¶³ã€‚

# 2025.02.24

æ‰§è¡Œå±‚çš„ JSON-RPC è§„èŒƒæ–‡æ¡£ https://ethereum.github.io/execution-apis/api-documentation/

## https://hackmd.io/@danielrachi/engine_api

ä¸¤ä¸ªå®¢æˆ·ç«¯å…ˆé€šè¿‡ engine_exchangeCapabilities and engine_forkchoiceUpdatedV2 æ¡æ‰‹å»ºç«‹é€šä¿¡ã€‚

ä¸åœåœ° call API è¿›è¡Œæ¢æµ‹æ˜¯å¦åŒæ­¥å®Œæˆäº† blocksã€‚

æ„å»ºä¸€ä¸ª Block çš„æµç¨‹ï¼š

![image](https://github.com/user-attachments/assets/5469d351-2efc-4483-8697-f4e128760b2b)

å…ˆæ˜¯ Validator è¢«é€‰ä¸­å‡ºå—ï¼Œç„¶åæ„å»º execution_payload ç„¶åè¢« CL è¯»å–ï¼Œå°†æ‰§è¡Œç»“æœæ”¾åœ¨ BeaconBlock ä¸Šé¢ï¼Œç„¶åè®¡ç®— state_root å‘é€ Block å‡ºå»ã€‚

# 2025.02.25

## https://gisli.hamstur.is/2020/08/understanding-ethereum-by-studying-the-source-code/

### Account model

core/state/state_object.go

```
// Account is the Ethereum consensus representation of accounts.
// These objects are stored in the main account trie.
type Account struct {
	Nonce    uint64
	Balance  *big.Int
	Root     common.Hash // merkle root of the storage trie
	CodeHash []byte
}
```

### p2p network

The Ethereum Node Records (ENR) is an open format for peer-to-peer connectivity information. 

```
p2p/enr/enr.go

// Record represents a node record. The zero value is an empty record.
type Record struct {
	seq       uint64 // sequence number
	signature []byte // the signature
	raw       []byte // RLP encoded record
	pairs     []pair // sorted list of all key/value pairs
}

p2p/enode/node.go

// ID is a unique identifier for each node.
type ID [32]byte

// Node represents a host on the network.
type Node struct {
	r  enr.Record
	id ID
}

// Load retrieves an entry from the underlying record.
func (n *Node) Load(k enr.Entry) error {
	return n.r.Load(k)
}

// IP returns the IP address of the node. This prefers IPv4 addresses.
func (n *Node) IP() net.IP {
	var (
		ip4 enr.IPv4
		ip6 enr.IPv6
	)
	if n.Load(&ip4) == nil {
		return net.IP(ip4)
	}
	if n.Load(&ip6) == nil {
		return net.IP(ip6)
	}
	return nil
}
```

### Networks and their genesis

```
params/config.go

	// MainnetChainConfig is the chain parameters to run a node on the main network.
	MainnetChainConfig = &ChainConfig{
		ChainID:             big.NewInt(1),
		HomesteadBlock:      big.NewInt(1150000),
		DAOForkBlock:        big.NewInt(1920000),
		DAOForkSupport:      true,
		EIP150Block:         big.NewInt(2463000),
		EIP150Hash:          common.HexToHash("0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0"),
		EIP155Block:         big.NewInt(2675000),
		EIP158Block:         big.NewInt(2675000),
		ByzantiumBlock:      big.NewInt(4370000),
		ConstantinopleBlock: big.NewInt(7280000),
		PetersburgBlock:     big.NewInt(7280000),
		IstanbulBlock:       big.NewInt(9069000),
		MuirGlacierBlock:    big.NewInt(9200000),
		Ethash:              new(EthashConfig),
	}
```

ä¸€äº› blockchain çš„å¯åŠ¨å‚æ•°ã€‚

```
core/genesis.go

// GenesisAlloc specifies the initial state that is part of the genesis block.
type GenesisAlloc map[common.Address]GenesisAccount

// DefaultGenesisBlock returns the Ethereum main net genesis block.
func DefaultGenesisBlock() *Genesis {
	return &Genesis{
		Config:     params.MainnetChainConfig,
		Nonce:      66,
		ExtraData:  hexutil.MustDecode("0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"),
		GasLimit:   5000,
		Difficulty: big.NewInt(17179869184),
		Alloc:      decodePrealloc(mainnetAllocData),
	}
}

func decodePrealloc(data string) GenesisAlloc {
	var p []struct{ Addr, Balance *big.Int }
	if err := rlp.NewStream(strings.NewReader(data), 0).Decode(&p); err != nil {
		panic(err)
	}
	ga := make(GenesisAlloc, len(p))
	for _, account := range p {
		ga[common.BigToAddress(account.Addr)] = GenesisAccount{Balance: account.Balance}
	}
	return ga
}
```


**RLP**ï¼ˆ**Recursive Length Prefix**ï¼‰æ˜¯ä»¥å¤ªåŠä¸­ç”¨äº**åºåˆ—åŒ–**ï¼ˆæˆ–ç¼–ç ï¼‰ä»»æ„åµŒå¥—çš„ã€åŸºäºå­—èŠ‚åºåˆ—çš„ç»“æ„çš„ä¸€ç§ç¼–ç æ–¹å¼ã€‚å®ƒçš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†åœ¨ä»¥å¤ªåŠçš„å„ç±»æ•°æ®ï¼ˆå¦‚è´¦æˆ·ä¿¡æ¯ã€äº¤æ˜“ã€åŒºå—å¤´ã€é»˜å…‹å°”æ ‘èŠ‚ç‚¹ç­‰ï¼‰ä¹‹é—´è¿›è¡Œé«˜æ•ˆå’Œä¸€è‡´çš„ç¼–ç ä¸ä¼ è¾“ã€‚ä¸‹é¢å¯¹ RLP çš„è¦ç‚¹è¿›è¡Œç®€è¦è¯´æ˜ï¼š

1. **ç”¨é€”ä¸å®šä½**  
   - **é€šç”¨ç¼–ç æ–¹æ¡ˆ**ï¼šä»¥å¤ªåŠéœ€è¦ä¸€ç§é€šç”¨çš„ç¼–ç æ–¹å¼ï¼Œèƒ½å¤Ÿå¯¹å„ç§ç»“æ„åŒ–æ•°æ®è¿›è¡Œæ‰“åŒ…å¹¶åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚RLP å°±æ˜¯ä»¥å¤ªåŠåº•å±‚æ‰€ä½¿ç”¨çš„ç¼–ç è§„èŒƒï¼Œå¯ä»¥åº”ç”¨äºç®€å•çš„å­—ç¬¦ä¸²ã€æ•°å­—ã€åˆ—è¡¨ï¼Œä»¥åŠåµŒå¥—åˆ—è¡¨ï¼ˆæ¯”å¦‚å¤šå±‚æ•°ç»„ï¼‰çš„ç¼–ç ä¸­ã€‚
   - **ä¸ JSONã€Protobuf ç­‰çš„åŒºåˆ«**ï¼šç›¸æ¯”äº JSON æˆ–è€… Protocol Buffersï¼ˆProtobufï¼‰ï¼ŒRLP æ›´åŠ è½»é‡ã€æ ¼å¼æ›´ç´§å‡‘ï¼Œä¸”æ˜“äºåœ¨æ™ºèƒ½åˆçº¦ã€åŒºå—é“¾èŠ‚ç‚¹ä¹‹é—´åšå¿«é€Ÿå¤„ç†ã€‚æ­¤å¤–ï¼ŒRLP åªå…³å¿ƒåŸå§‹å­—èŠ‚ï¼Œä¸å…³å¿ƒå®é™…çš„å­—æ®µå«ä¹‰æˆ–æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼‰ï¼Œè¿™ä½¿å¾—å®ƒéå¸¸çµæ´»ã€‚

2. **ç¼–ç è§„åˆ™**  
   RLP é€šè¿‡â€œå‰ç¼€ + æ•°æ®â€çš„æ–¹å¼æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–åˆ—è¡¨ï¼‰ã€‚  
   - **å•ä¸ªå­—èŠ‚**ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæˆ–æ•°å­—åœ¨å­—èŠ‚å±‚é¢çš„è¡¨ç¤ºï¼‰æœ¬èº«åªåŒ…å«ä¸€ä¸ªå­—èŠ‚ï¼Œä¸”æ•°å€¼å°äº 0x80ï¼Œé‚£ä¹ˆç¼–ç åå°±æ˜¯å®ƒè‡ªå·±ï¼Œä¸éœ€è¦å‰ç¼€ã€‚  
   - **å­—ç¬¦ä¸²/å­—èŠ‚åºåˆ—**ï¼šå¯¹äºé•¿åº¦åœ¨ 0ï½55 å­—èŠ‚ä¹‹é—´çš„éå•å­—èŠ‚æ•°æ®ï¼ŒRLP ä½¿ç”¨ 0x80 + æ•°æ®é•¿åº¦ä½œä¸ºå‰ç¼€ã€‚è‹¥å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡ 55 å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨ 0xB7 ä¹‹åå†ç´§è·Ÿè¡¨ç¤ºé•¿åº¦çš„å­—èŠ‚æ•°ï¼Œä¹‹åå†è·ŸåŸå§‹æ•°æ®ã€‚  
   - **åˆ—è¡¨**ï¼šåˆ—è¡¨åŒç†ã€‚é•¿åº¦åœ¨ 0ï½55 å­—èŠ‚ä¹‹é—´æ—¶ä½¿ç”¨ 0xC0 + åˆ—è¡¨ç¼–ç åå­—èŠ‚é•¿åº¦ä½œä¸ºå‰ç¼€ã€‚å¦‚æœåˆ—è¡¨æ•´ä½“é•¿åº¦è¶…è¿‡ 55 å­—èŠ‚ï¼Œå°±ä½¿ç”¨ 0xF7 ä¹‹åå†ç´§è·Ÿè¡¨ç¤ºé•¿åº¦çš„å­—èŠ‚æ•°ï¼Œç„¶åå†è·Ÿåˆ—è¡¨çš„åŸå§‹å†…å®¹ã€‚

3. **ç¤ºä¾‹**  
   - å¦‚æœè¦ç¼–ç ä¸€ä¸ªç©ºå­—ç¬¦ä¸² `""`ï¼š  
     - ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé•¿åº¦ä¸º 0ï¼Œäºæ˜¯ç¼–ç ç»“æœæ˜¯ `0x80`ã€‚  
   - å¦‚æœè¦ç¼–ç å•ä¸ªå­—èŠ‚ `0x05`ï¼ˆä¹Ÿå°±æ˜¯æ•´æ•° 5 çš„å­—èŠ‚å½¢å¼ï¼‰ï¼Œå› ä¸ºå®ƒå°äº 0x80ï¼Œæ‰€ä»¥ç›´æ¥å°±æ˜¯ `0x05`ã€‚  
   - å¦‚æœè¦ç¼–ç å­—ç¬¦ä¸² `"cat"`ï¼ˆASCIIï¼š0x63 0x61 0x74ï¼‰ï¼Œå…¶é•¿åº¦ä¸º 3ï¼Œå› æ­¤å‰ç¼€ä¼šæ˜¯ `0x80 + 3 = 0x83`ï¼Œåé¢è·Ÿä¸Š â€œcatâ€ çš„å­—èŠ‚ï¼Œæ‰€ä»¥ç¼–ç ç»“æœä¸º `0x83 63 61 74`ã€‚  
   - å¦‚æœæ˜¯åŒ…å«å¤šä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼ˆæ¯”å¦‚ `[ "cat", "dog" ]`ï¼‰ï¼Œåˆ™å…ˆåˆ†åˆ«å¯¹ `"cat"` å’Œ `"dog"` åš RLP ç¼–ç ï¼Œå†å°†ä¸¤è€…æ‹¼èµ·æ¥ï¼Œå†å¯¹æ‹¼èµ·æ¥çš„ç»“æœå‰é¢åŠ ä¸Šè¡¨ç¤ºâ€œåˆ—è¡¨é•¿åº¦â€çš„å‰ç¼€ã€‚

4. **åœ¨ä»¥å¤ªåŠä¸­çš„åº”ç”¨åœºæ™¯**  
   - **äº¤æ˜“æ•°æ®**ï¼šä»¥å¤ªåŠäº¤æ˜“ä¼šç”¨ RLP å¯¹åœ°å€ã€é‡‘é¢ã€nonce ç­‰å­—æ®µè¿›è¡Œæ‰“åŒ…ã€‚  
   - **åŒºå—æ•°æ®**ï¼šåŒºå—å¤´åŠåŒºå—ä¸­å…¶ä»–ç»“æ„ï¼ˆå¦‚äº¤æ˜“åˆ—è¡¨ã€å”å—åˆ—è¡¨ç­‰ï¼‰çš„ç¼–ç ã€è§£ç éƒ½ä½¿ç”¨ RLPã€‚  
   - **å­˜å‚¨åŠé»˜å…‹å°”æ ‘èŠ‚ç‚¹**ï¼šåœ¨ä»¥å¤ªåŠçš„ Patricia Trieï¼ˆMerkle Patricia Trieï¼‰é‡Œï¼ŒèŠ‚ç‚¹ä¹Ÿæ˜¯ä»¥ RLP å½¢å¼å­˜å‚¨æˆ–è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚

5. **ä¼˜åŠ¿**  
   - **ç´§å‡‘æ€§**ï¼šRLP çš„ç¼–ç ç›¸å¯¹ç®€å•å¹¶ä¸”ç´§å‡‘ï¼Œå°½å¯èƒ½å‡å°‘å†—ä½™ä¿¡æ¯ï¼Œæé«˜å­˜å‚¨åŠç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚  
   - **å®ç°ç®€å•**ï¼šRLP çš„ç¼–ç è§£ç é€»è¾‘å¹¶ä¸ä¾èµ–å…·ä½“çš„æ•°æ®ç»“æ„å®šä¹‰ï¼Œæ˜¯ä¸€å¥—é€šç”¨çš„å­—èŠ‚çº§åˆ«ç¼–ç è§„åˆ™ï¼Œå› æ­¤å¾ˆå®¹æ˜“åœ¨ä¸åŒç¼–ç¨‹è¯­è¨€é‡Œå®ç°ã€‚  
   - **çµæ´»æ€§**ï¼šä¸å¯¹å­—æ®µæ„ä¹‰åšè¿‡å¤šé™åˆ¶ï¼Œä¸“æ³¨äºæŠŠä»»æ„çš„ï¼ˆåµŒå¥—ï¼‰å­—èŠ‚åºåˆ—ç»“æ„ç»™â€œæ‰“åŒ…â€å¥½ã€‚

6. **å±€é™æ€§**  
   - **ç¼ºä¹æ•°æ®ç±»å‹è¯­ä¹‰**ï¼šä¾‹å¦‚ï¼Œå¯¹ä¸€ä¸²å­—èŠ‚ï¼Œä½ å¹¶ä¸çŸ¥é“å®ƒåˆ°åº•æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•°å­—ï¼Œéœ€è¦ç»“åˆä¸Šå±‚é€»è¾‘è§£é‡Šã€‚  
   - **è°ƒè¯•ä¸å¦‚ JSONã€Protobuf ç›´è§‚**ï¼šç”¨å·¥å…·æŸ¥çœ‹ RLP ç¼–ç çš„äºŒè¿›åˆ¶æ•°æ®ä¼šç›¸å¯¹æŠ½è±¡ï¼Œé˜…è¯»ä¸å¦‚ JSON æˆ–å…¶ä»–æ›´é«˜çº§åˆ«ç¼–ç æ¥å¾—å‹å¥½ï¼Œéœ€è¦ä¸€äº›è§£ç å™¨å·¥å…·ã€‚

---

ç»¼ä¸Šï¼Œ**RLP** å°±æ˜¯åœ¨ä»¥å¤ªåŠä¸­éå¸¸æ ¸å¿ƒçš„**åº•å±‚æ•°æ®ç¼–ç åè®®**ã€‚å®ƒä»¥ç®€æ´çš„å‰ç¼€è§„åˆ™å¯¹å„ç±»æ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼Œä¸ºä»¥å¤ªåŠåœ¨ç½‘ç»œä¸å­˜å‚¨ä¸­çš„é«˜æ•ˆæ•°æ®ä¼ è¾“å’Œå­˜å‚¨æä¾›äº†åŸºç¡€ã€‚

# 2025.02.26

### Connecting via bootnodes

```
// MainnetBootnodes are the enode URLs of the P2P bootstrap nodes running on
// the main Ethereum network.
var MainnetBootnodes = []string{
	// Ethereum Foundation Go Bootnodes
	"enode://d860a01f9722d78051619d1e2351aba3f43f943f6f00718d1b9baa4101932a1f5011f16bb2b1bb35db20d6fe28fa0bf09636d26a87d31de9ec6203eeedb1f666@18.138.108.67:30303", // bootnode-aws-ap-southeast-1-001
	"enode://22a8232c3abc76a16ae9d6c3b164f98775fe226f0917b0ca871128a74a8e9630b458460865bab457221f1d448dd9791d24c4e5d88786180ac185df813a68d4de@3.209.45.79:30303",   // bootnode-aws-us-east-1-001
	"enode://2b252ab6a1d0f971d9722cb839a42cb81db019ba44c08754628ab4a823487071b5695317c8ccd085219c3a03af063495b2f1da8d18218da2d6a82981b45e6ffc@65.108.70.101:30303", // bootnode-hetzner-hel
	"enode://4aeb4ab6c14b23e2c4cfdce879c04b0748a20d8e9b59e25ded2a08143e265c6c25936e74cbc8e641e3312ca288673d91f2f93f8e277de3cfa444ecdaaf982052@157.90.35.166:30303", // bootnode-hetzner-fsn
}
```

èŠ‚ç‚¹å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå»æ‰¾ç›¸å…³çš„å¯åŠ¨èŠ‚ç‚¹ã€‚ä½œç”¨ï¼Ÿè·å–ä¸€äº›å¿…è¦å¯åŠ¨ä¿¡æ¯ï¼Ÿä¼šä¸ä¼šæœ‰ä¸­å¿ƒåŒ–çš„é—®é¢˜æˆ–è€…è¢« DDoS çš„é—®é¢˜ã€‚æš‚æ—¶ä¸çŸ¥é“å…·ä½“æ˜¯åšä»€ä¹ˆçš„ã€‚

### Discovering peers

The discovery protocol relies on a Kademlia-like DHT that stores information about Ethereum nodes.

TODO Kademlia-like DHT æ˜¯ä»€ä¹ˆï¼Ÿ

```
// RequestENR sends ENRRequest to the given node and waits for a response.
func (t *UDPv4) RequestENR(n *enode.Node) (*enode.Node, error) {
	addr, _ := n.UDPEndpoint()
	t.ensureBond(n.ID(), addr)

	req := &v4wire.ENRRequest{
		Expiration: uint64(time.Now().Add(expiration).Unix()),
	}
	packet, hash, err := v4wire.Encode(t.priv, req)
	if err != nil {
		return nil, err
	}

	// Add a matcher for the reply to the pending reply queue. Responses are matched if
	// they reference the request we're about to send.
	rm := t.pending(n.ID(), addr.Addr(), v4wire.ENRResponsePacket, func(r v4wire.Packet) (matched bool, requestDone bool) {
		matched = bytes.Equal(r.(*v4wire.ENRResponse).ReplyTok, hash)
		return matched, matched
	})
	// Send the packet and wait for the reply.
	t.write(addr, n.ID(), req.Name(), packet)
	if err := <-rm.errc; err != nil {
		return nil, err
	}
	// Verify the response record.
	respN, err := enode.New(enode.ValidSchemes, &rm.reply.(*v4wire.ENRResponse).Record)
	if err != nil {
		return nil, err
	}
	if respN.ID() != n.ID() {
		return nil, errors.New("invalid ID in response record")
	}
	if respN.Seq() < n.Seq() {
		return n, nil // response record is older
	}
	if err := netutil.CheckRelayAddr(addr.Addr(), respN.IPAddr()); err != nil {
		return nil, fmt.Errorf("invalid IP in response record: %v", err)
	}
	return respN, nil
}
```

# 2025.02.27

### Propagating blocks

node èµ·æ¥ä¹‹åå°±éœ€è¦åŒæ­¥å…¨éƒ¨çš„ blockï¼Œé€šè¿‡ä½¿ç”¨ total difficulty æ¥åˆ¤æ–­ peers ä¸­æœ€é•¿çš„ chainã€‚

è¿™ä¸€éƒ¨åˆ†é€šè¿‡ PoW çš„å·²ç»è¿‡æ—¶äº†ã€‚

### State transition

éªŒè¯äº¤æ˜“è¿™é‡Œï¼Œé€šè¿‡ EIP155 æ ‡å‡†å®ç°ç­¾åï¼Œå¹¶ä¸”è¿›è¡ŒéªŒè¯ã€‚ä½¿ç”¨äº† Ecrecover çš„åŠ å¯†ç®—æ³•ï¼Œä¸»è¦æ˜¯å…ˆéªŒè¯ç­¾åçš„æœ‰æ•ˆæ€§ï¼Œç„¶åå†æ ¹æ®ç­¾åæ¢å¤å‡ºæ¥å…¬é’¥å’Œé’±åŒ…åœ°å€ï¼Œé€šè¿‡åˆ¤æ–­é’±åŒ…åœ°å€æ˜¯å¦æ˜¯ç­¾åçš„åœ°å€æ¥ç¡®è®¤å½“å‰çŠ¶æ€æœ‰æ•ˆã€‚EIP-155 æ˜¯é¢„é˜²äº¤æ˜“åœ¨ä¸åŒé“¾ä¸Šé‡æ”¾ã€‚

ç­¾åçš„æ ¸å¿ƒå­—æ®µï¼šäº¤æ˜“çš„å“ˆå¸Œå€¼ç”± AccountNonceã€Priceã€GasLimit ç­‰å­—æ®µä»¥åŠ chainId è®¡ç®—å¾—å‡ºã€‚

ç­¾åæ¢å¤è¿‡ç¨‹ï¼šé€šè¿‡ Vã€R å’Œ S æ¢å¤å…¬é’¥ï¼Œè¿›è€Œè®¡ç®—å‡ºå‘é€è€…åœ°å€ã€‚

é”™è¯¯å¤„ç†ï¼šå¦‚æœ chainId ä¸åŒ¹é…æˆ–ç­¾åæ— æ•ˆï¼Œä¼šè¿”å›ç›¸åº”çš„é”™è¯¯ã€‚

# 2025.02.28

### Executing code in the EVM

TODO EVM å®˜æ–¹æŠ€æœ¯èµ„æ–™æ–‡æ¡£ https://ethereum.org/en/developers/docs/evm/

ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦æ˜¯ä¸€ç§åº•å±‚çš„ stack-based bytecode è¯­è¨€ï¼ŒåŒ…æ‹¬ä¸€å † bytesï¼Œæ¯ä¸ª byte è¡¨ç¤ºä¸€ä¸ªæ“ä½œã€‚

TODOï¼Œå†™ä¸€ä¸ª byte å¯¹ä»¥å¤ªåŠ EVM è¿›è¡Œè°ƒç”¨å’Œè®¡ç®—ã€‚

æ“ä½œä½œç”¨äºä¸‹é¢ä¸‰ç§ç±»å‹çš„å­˜å‚¨ï¼š

- The stackï¼Œå°±æ˜¯è¿è¡Œè¿‡ç¨‹ä¸­çš„å †æ ˆ
- Memory è¿è¡Œå†…å­˜ï¼Œbyte array
- contract long-term storageï¼Œé•¿æœŸå­˜å‚¨å†…å®¹

æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰æŒ‡å®š tx recipientï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°åˆçº¦ï¼Œä»£ç å­˜å‚¨åœ¨ contract account state é‡Œé¢ã€‚ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ contract constructor ç„¶ååˆ›å»ºåˆå§‹ state å¹¶ä¸”è¿”å› final contract bytecodeï¼Œæ‰€ä»¥ constructors åœ¨ deploy ä¹‹åï¼Œå°±ä¸ä¿å­˜äº†ã€‚

åˆçº¦ä¹‹é—´é€šè¿‡ sending messages æ¥è¿›è¡Œç›¸äº’è°ƒç”¨ã€‚

é€šè¿‡ gas æ¶ˆè€—æ¥é¿å… DDoS æ”»å‡»ã€‚gas price æ˜¯ originator æ„¿æ„æ”¯ä»˜çš„æ¯ä¸ª gas çš„ä»·æ ¼ï¼Œgas limit æ˜¯ upper bound originator æ„¿æ„ä¸ºè¿™ä¸ª tx æ”¯ä»˜çš„ï¼Œé¿å…å…¨éƒ¨èŠ±å®Œäº†ã€‚å®é™…ä¸Šéœ€è¦çš„ gas æ˜¯ç”±æ™ºèƒ½åˆçº¦æ‰§è¡Œçš„å…·ä½“ opcode æ¥å†³å®šçš„ï¼Œæ˜¯å›ºå®šçš„ã€‚ç±»æ¯”æ±½è½¦å°±æ˜¯æˆ‘ä» A åˆ° B èµ° 100KM éœ€è¦å›ºå®šæ¶ˆè€— 15L çš„æ±½æ²¹ï¼Œè¿™ä¸ª 15L çš„æ±½æ²¹å°±æ˜¯ 15L çš„æ±½æ²¹ï¼Œå› ä¸ºå¿…é¡»è¦èµ° 100KM çš„è·¯ã€‚ç„¶åæ±½æ²¹ä»·æ ¼æ˜¯æ¯ä¸ªåŠ æ²¹ç«™ä¸ä¸€æ ·çš„ï¼Œä½ å¯ä»¥é€‰æ‹©ä¾¿å®œçš„æ±½æ²¹å‹å·æˆ–è€…åŠ æ²¹ç«™ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©è´µçš„ã€‚é‚£ä¹ˆå®é™…çš„æ”¯å‡ºå°±æ˜¯ 15L x æ±½æ²¹ä»·æ ¼ï¼Œä½ å¯ä»¥é™åˆ¶æœ€å¤šèŠ±è´¹çš„ä»·æ ¼ï¼Œæ¯”å¦‚ 100 åˆ€è¿™æ ·æœ€å¤šåªèƒ½åˆ° 100 åˆ€ã€‚å‡å¦‚æ­¤æ—¶ 1L æ²¹ä»· 10 åˆ€ï¼Œé‚£ä¹ˆ 100 åˆ€çš„ Limit åªèƒ½è·‘ 10L å¯¹åº”çš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è¾¾åˆ° 100KM çš„è·ç¦»ï¼Œæ­¤æ—¶åœ¨ EVM é‡Œé¢å°±ä¼šå› ä¸º gas ä¸è¶³ï¼Œç»ˆæ­¢è¿™é¡¹å·¥ä½œï¼Œå› ä¸ºèµ°ä¸åˆ°ç»ˆç‚¹ã€‚ä½†æ˜¯ç”±äºç¡®å®å­˜åœ¨è¿ç®—ï¼Œæˆ–è€…åœ¨è·¯ä¸Šè·‘äº†ä¸€æ®µæ—¶é—´ï¼Œgas ä¹Ÿç¡®å®æ¶ˆè€—æ‰äº†ï¼Œæ‰€ä»¥å·²ç»æ¶ˆè€—çš„ gas å°±ä¸é€€è¿˜äº†ã€‚

éœ€è¦ä»˜å‡ºæˆæœ¬ï¼Œä¹Ÿæ˜¯é˜»æ­¢æ»¥ç”¨çš„ä¸€ç§æ–¹æ¡ˆã€‚

```
core/vm/contract.go

// UseGas attempts the use gas and subtracts it and returns true on success
func (c *Contract) UseGas(gas uint64) (ok bool) {
	if c.Gas < gas {
		return false
	}
	c.Gas -= gas
	return true
}
```

### Transacting

Ethereum uses the ECDSA signature scheme for the secp256k1 elliptic curve. 

Ethereumä½¿ç”¨secp256k1æ¤­åœ†æ›²çº¿çš„ECDSAç­¾åæ–¹æ¡ˆã€‚åŠ å¯†æ¨¡å—ä¸ºcrypto.Signæä¾›ä¸¤ç§å®ç°ï¼Œä¸€ç§ä¾èµ–ç”¨çº¯Goç¼–å†™çš„æ¤­åœ†æ›²çº¿å¯†ç åº“ï¼Œå¦ä¸€ç§ä¾èµ–ç”¨Cç¼–å†™å¹¶é€šè¿‡cgoè°ƒç”¨çš„libsecp256k1ã€‚ECDSAç­¾åä»¥ä¸€å¯¹æ•´æ•°(r,s)çš„å½¢å¼è¿”å›ï¼Œæ¯ä¸ªå€¼çš„èŒƒå›´ä¸º[1,2^256-1]ï¼Œå…¶ä¸­ræ˜¯éšæœºç‚¹R=k*Gçš„xåæ ‡ï¼Œs=k^-1*(h+r*privKey)æ˜¯ç­¾åè€…çŸ¥é“æ¶ˆæ¯h=hash(msg)å’Œç§é’¥privKeyçš„è¯æ˜ã€‚å¯¹äºå·²ç­¾åçš„äº¤æ˜“ï¼ŒèŠ‚ç‚¹ä¼šæŒ‰ä¸Šè¿°æ–¹å¼å°†å…¶ä¸­ç»§åˆ°ç‚¹å¯¹ç‚¹ç½‘ç»œã€‚

æœ€å…³é”®çš„æ˜¯ ECDSA signature scheme allows the public key to be recovered from the signed message together with the signatureï¼Œé€šè¿‡å¯¹æ¯” signature è¿˜åŸå‡ºæ¥çš„ public key æ¥éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦çœŸæ­£æœ‰ private keyã€‚

---

å¯¹ EVM æ„Ÿå…´è¶£ï¼Œåé¢çš„æ—¶é—´æ·±å…¥ç ”ç©¶ä¸‹ https://ethereum.org/en/developers/docs/evm/

debug ä¸‹ä»£ç ï¼šhttps://github.com/ethereumjs/ethereumjs-monorepo/tree/master/packages/evm

# 2025.03.01

## https://ethereum.org/en/developers/docs/evm/

![image](https://github.com/user-attachments/assets/5033f9d6-3b68-44d1-9665-76dcfad20383)

- PC æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆè¿è¡Œçš„

Instead of a distributed ledger, Ethereum is a distributed state machine(opens in a new tab). Ethereum's state is a large data structure which holds not only all accounts and balances, but a machine state, which can change from block to block according to a pre-defined set of rules, and which can execute arbitrary machine code.

State é€šè¿‡ MPT å­˜å‚¨çš„åºå¤§æ•°æ®ç»“æ„ï¼Œé€šè¿‡ Hash å°†æ‰€æœ‰è´¦æˆ·è¿æ¥èµ·æ¥å¹¶ä¸”æœ‰ä¸€ä¸ª root hashã€‚

æœ‰ä¸¤ç§ txsï¼š1. message calls 2. create contract

åˆçº¦çš„åˆ›å»ºå°±æ˜¯æŠŠ smart contract bytecode è¿›è¡Œç¼–ç ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª account å°†å…¶è¿›è¡Œå­˜å‚¨ã€‚ä¹‹åæœ‰å…¶ä»–çš„ account è°ƒç”¨ message call å°±æ˜¯æ‰§è¡Œè¿™ä¸ªä¸Šé¢çš„ bytecodeã€‚

EVM çš„ stack machine æ·±åº¦æ˜¯ 1024 itemsï¼Œæ¯ä¸€ä¸ª item æ˜¯ 256-bit wordï¼Œè¿™æ ·æ¯”è¾ƒå®¹æ˜“é€‚é… 256-bit cryptographyï¼Œä¾‹å¦‚ Keccak-256 hashes æˆ–è€… secp256k1 signaturesã€‚

TODO EVM è¿™è¾¹ï¼Œè¿˜éœ€è¦æŠŠ https://ethereumjs.readthedocs.io/en/latest/introduction.html å’Œå¯¹åº”æºä»£ç è·‘ä¸€ä¸‹ï¼Œè¿™æ ·å°±ç®—å½»åº•ææ‡‚äº†ã€‚


<!-- Content_END -->
